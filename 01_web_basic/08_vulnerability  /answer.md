## 課題１（質問）
### 各脆弱性の仕組み、発生し得る被害、対処法
#### XSS
- 仕組み
  - ユーザが入力するコンテンツに悪意のあるスクリプトを埋め込むことで、各ユーザのブラウザ上でそのスクリプトが実行される。
- 被害
  - 投入されたスクリプトからクッキーにアクセスされ、クッキー情報を別のサーバに送られてしまう。そのクッキー情報に「ログイン済み」のセッショントークンが含まれているとID, パスワードがなくてもログインしている状態を得られてしまう。
- 対処法
  - ユーザが入力したコンテンツをそのまま出力せずに、"<", ">"などの一部記号をエスケープする。
  - Set-cookieにhttpOnly属性を付与して、JavaScriptからクッキーにアクセスすることを防止する。

#### コマンドインジェクション
- 仕組み
  - ユーザが入力するコンテンツにシェルコマンドを埋め込むことで、OSに対して不正に命令する。
- 被害
  -ファイルの改ざんやシステムを停止させられる。
- 対処法
  - OSコマンドの呼び出しを使わない実装方法を選択する。
  - シェル呼び出し機能のある関数の利用を避ける。
  - 外部から入力された文字列をコマンドラインのパラメータに渡さない。
  - OSコマンドに渡すパラメータを安全に関数によりエスケープする。

#### SQLインジェクション
- 仕組み
  - ユーザが入力するコンテンツにSQLを埋め込むことで、DBのデータを不正に操作する。
- 被害
  - クレジットカードの番号を盗み取られたり、データを削除される
- 対処法
  - ユーザが入力したコンテンツをエスケープしてからSQLを発行する。

#### CSRF
- 仕組み
  - 悪意のある第三者が用意した攻撃用のサイトからリクエストさせることで、セッションIDを含むクッキー　本来はログインしたユーザのみが許される処理を実行させる。
- 被害
  - 本人が意図しないリクエスト（SNSへの投稿、オンライン決済）を強制されることで、社会的信用を失ったり金銭的被害を受ける。
- 対処法
  - ユーザ側
    - 怪しいリンクは踏まない。
  - サーバ側
    - HTTPリクエストヘッダのReferer属性をチェックし、他ドメインからのリクエストは拒否する（ただし、Refererの偽装は容易）。
    - フォームでトークンを発行し、そのトークンがないとリクエストを受け付けないようにする。

## 課題２（クイズ）
XSSは、攻撃用のスクリプトを紛れ込ませる手法により３つに分類される。その3つの種類を答えてください。

## 課題３（実演）
### DVWAに攻撃
#### コマンドインジェクション
Command Injectionで、`;`の後に任意のコマンドを入力する。
例えば`; rm index.php`などでファイルの削除ができてしまう。

#### SQLインジェクション
SQL Injectionで、`a' OR ''='`を入力すると、全ユーザの情報を取得することができる。

#### CSRF
以下のようなパスワード変更フォームを持つダミーサイトを用意する。
```html
<form action="#" method="GET">
  New password:<br />
  <input type="password" AUTOCOMPLETE="off" name="password_new"><br />
  Confirm new password:<br />
  <input type="password" AUTOCOMPLETE="off" name="password_conf"><br />
  <br />
  <input type="submit" value="Change" name="Change">
</form>
```

action属性に任意の送信先URLを設定することで、そのURLでのパスワードを変更することができる。

#### XSS
Reflected Cross Site Scripting (XSS)で、`<script>alert('xss')</script>`を入力すると`xss`と表示されるalertを出すことができる。

### 各攻撃に対しての防御手段
#### コマンドインジェクション
ユーザが入力した`;`や`<`などの特殊文字をエスケープする。

#### SQLインジェクション
ユーザが入力した`'`などの特殊文字をエスケープする。

#### CSRF
ワンタイムトークンをフォーム中に埋め込み、サーバに送られたワンタイムトークンを検証してから処理をする。

#### XSS
ユーザが入力した`<`や`>`などの特殊文字をエスケープする。
